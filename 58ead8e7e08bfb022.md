# Vendor

SeriaWei

# Product

ZKEACMS

# version

v4.3

# Download 

https://github.com/SeriaWei/ZKEACMS/releases

https://www.zkea.net/download

# Vulnerability

Non-blind SSRF

# Description

The Proxy method in MediaController allows users to request the content of an arbitrary URL. Although this operation requires ViewMedia permission, once the attacker has the corresponding permissions, he can use this vulnerability to detect the company's intranet and attack the intranet services.

# Analysis


The vulnerability exists in the `Proxy` method(src/ZKEACMS/Controllers/MediaController.cs) of the `MediaController`, as shown below:

```
public async Task<IActionResult> Proxy(string url)
{
    return File(await Service.GetStreamAsync(url), "image/jpeg");
}
```
As you pointed out, this code is located at line 219.

Root Cause of the Vulnerability

1. Lack of Input Validation and Filtering: The `Proxy` method directly accepts the `url` parameter from the user without any validation, filtering, or restriction. This means an attacker can craft an arbitrary URL, including addresses pointing to the internal network (e.g., `http://127.0.0.1:8080`).

2. Server-Side Request Initiation: The `Service.GetStreamAsync(url)` method initiates a network request from the server-side based on the user-provided `url`. When the server executes this request, its network access privileges are typically higher than those of a regular external user, allowing it to access internal network resources.

Vulnerability Verification:

<img width="1176" height="551" alt="image" src="https://github.com/user-attachments/assets/7808a614-8f1c-47f1-a892-d520aa761d18" />


# POC
```
GET /admin/Media/Proxy?url=http://192.168.1.81:38530/ HTTP/1.1
Host: 192.168.1.81:5000
Cookie: .AspNetCore.DefaultAuthenticationScheme=XXX

```





